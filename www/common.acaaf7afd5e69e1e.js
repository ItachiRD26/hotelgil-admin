"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[76],{1467:(F,S,y)=>{y.d(S,{g:()=>R});var d=y(467),N=y(4002),g=y(5295);const v=[{roomNumber:"03",roomType:"Sencilla",price:1200},{roomNumber:"04",roomType:"VIP",price:1700},{roomNumber:"05",roomType:"Sencilla",price:1200},{roomNumber:"101",roomType:"Sencilla",price:1200},{roomNumber:"107",roomType:"Doble",price:1700},{roomNumber:"102",roomType:"Doble",price:1700},{roomNumber:"103",roomType:"Sencilla",price:1200},{roomNumber:"104",roomType:"Triple",price:2500},{roomNumber:"105",roomType:"Sencilla",price:1200},{roomNumber:"106",roomType:"Sencilla",price:1200},{roomNumber:"201",roomType:"Sencilla",price:1200},{roomNumber:"202",roomType:"Sencilla",price:1200},{roomNumber:"203",roomType:"Sencilla",price:1200},{roomNumber:"204",roomType:"Sencilla",price:1200},{roomNumber:"205",roomType:"Sencilla",price:1200},{roomNumber:"206",roomType:"Sencilla",price:1200},{roomNumber:"207",roomType:"Sencilla",price:1200},{roomNumber:"208",roomType:"Sencilla",price:1200},{roomNumber:"209",roomType:"Doble",price:1700},{roomNumber:"210",roomType:"Doble",price:1700},{roomNumber:"211",roomType:"Doble",price:1700},{roomNumber:"212",roomType:"Sencilla",price:1200},{roomNumber:"213",roomType:"Doble",price:1700},{roomNumber:"214",roomType:"Sencilla",price:1200},{roomNumber:"215",roomType:"Sencilla",price:1200},{roomNumber:"216",roomType:"Sencilla",price:1200},{roomNumber:"217",roomType:"Sencilla",price:1200},{roomNumber:"218",roomType:"Sencilla",price:1200},{roomNumber:"219",roomType:"Sencilla",price:1200}];var D=y(2615);let R=(()=>{var T;class b{getAllRooms(){return v}getAllReservations(){return(0,d.A)(function*(){const e=(0,N.KR)(g.db,"reservations"),o=yield(0,N.Jt)(e);if(!o.exists())return[];const r=o.val();return Object.values(r)})()}getRoomsWithStatus(){var e=this;return(0,d.A)(function*(o=new Date){const r=e.getAllRooms(),a=yield e.getAllReservations(),f=e.formatDate(o);return r.map(i=>{const m=a.filter(c=>!!c.rooms.some(p=>p.roomNumber===i.roomNumber)&&(!c.checkinDate||!c.checkoutDate||e.isDateInRange(f,c.checkinDate,c.checkoutDate)));let u,l="disponible";if(m.length>0){const c=m.find(n=>"checkin"===n.stayStatus),h=m.find(n=>!n.stayStatus),p=m.find(n=>"checkout"===n.stayStatus);c?(l="ocupada",u=c):h?(l="reservada",u=h):p&&(l="disponible",u=p)}return{...i,status:l,reservation:u}})}).apply(this,arguments)}getMonthlyRevenue(e,o){var r=this;return(0,d.A)(function*(){const a=yield r.getAllReservations(),f=yield r.getAllFacturas(),i=a.filter(t=>{if(!t.checkinDate)return!1;const s=r.safeParseYMD(t.checkinDate);return s.getMonth()===e&&s.getFullYear()===o}),m=f.filter(t=>{if(!t?.createdAt)return!1;const s=new Date(t.createdAt);return!isNaN(s.getTime())&&s.getMonth()===e&&s.getFullYear()===o}),l=i.reduce((t,s)=>t+Number(s.amountPaid||0)+Number(s.remaining||0),0),u=r.sumByPaymentMethod(i,"efectivo"),c=r.sumByPaymentMethod(i,"tarjeta"),h=r.sumByPaymentMethod(i,"transferencia"),p=m.filter(t=>!0===t?.fiscalData?.includeTax||!!t?.invoiceId).length,n=[];return i.forEach(t=>{Array.isArray(t.rooms)&&n.push(...t.rooms)}),{total:l,cash:u,card:c,transfer:h,fiscalCount:p,totalRoomsSold:n.length,sencillaCount:n.filter(t=>"sencilla"===String(t?.roomType||"").toLowerCase()).length,dobleCount:n.filter(t=>"doble"===String(t?.roomType||"").toLowerCase()).length,tripleCount:n.filter(t=>"triple"===String(t?.roomType||"").toLowerCase()).length,month:r.getMonthName(e),year:o}})()}getAllFacturas(){return(0,d.A)(function*(){const e=(0,N.KR)(g.db,"facturas"),o=yield(0,N.Jt)(e);if(!o.exists())return[];const r=o.val();return Object.values(r)})()}safeParseYMD(e){const o=new Date(`${e}T00:00:00`);if(!isNaN(o.getTime()))return o;const[r,a,f]=e.split("-").map(i=>Number(i));return new Date(r,(a||1)-1,f||1)}sumByPaymentMethod(e,o){return e.filter(r=>String(r.paymentMethod||"").toLowerCase()===o).reduce((r,a)=>r+Number(a.amountPaid||0)+Number(a.remaining||0),0)}formatDate(e){return`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}`}isDateInRange(e,o,r){return e>=o&&e<=r}getMonthName(e){return["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"][e]}static#e=T=()=>(this.\u0275fac=function(o){return new(o||b)},this.\u0275prov=D.jDH({token:b,factory:b.\u0275fac,providedIn:"root"}))}return T(),b})()}}]);